#!/usr/bin/env bash
set -euo pipefail

# Allow bypass when necessary
if [[ "${SKIP_COVERAGE_GUARD:-}" == "1" ]]; then
  echo "âš ï¸  Coverage guard bypassed via SKIP_COVERAGE_GUARD=1"
  exit 0
fi

# Skip guard in CI runners
if [[ "${CI:-}" == "true" ]]; then
  exit 0
fi

echo "ğŸ” Running coverage gate before pushâ€¦"

if npm run -s test:coverage >/dev/null 2>&1; then
  npm run -s test:coverage
else
  echo "âŒ Missing test:coverage script."
  exit 1
fi

echo "âœ… Coverage gate passed."
